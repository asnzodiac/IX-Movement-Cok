<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>AIX SEC OPS - Cochin Airport</title>
  <meta name="theme-color" content="#000000" />
  <link rel="manifest" href="manifest.json" />
  <style>
    :root {
      --bg-color: #ffffff;
      --text-color: #000000;
      --header-bg: #f0f0f0;
      --table-header-bg: #333333;
      --table-header-text: #ffffff;
      --border-color: #cccccc;
      --control-bg: #ffffff;
      --control-text: #000000;
      --delayed-row-bg: #fff0f0;
      --completed-row-bg: #f0fff0;
      --primary-color: #0066cc;
      --secondary-color: #e4f1fe;
      --highlight-color: #ffcc00;
    }

    [data-theme="dark"] {
      --bg-color: #1a1a1a;
      --text-color: #ffffff;
      --header-bg: #2a2a2a;
      --table-header-bg: #444444;
      --table-header-text: #ffffff;
      --border-color: #555555;
      --control-bg: #333333;
      --control-text: #ffffff;
      --delayed-row-bg: #3a2a2a;
      --completed-row-bg: #2a3a2a;
      --primary-color: #4d94ff;
      --secondary-color: #2a3a4a;
      --highlight-color: #cc9900;
    }

    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background-color: var(--bg-color);
      color: var(--text-color);
      transition: all 0.3s ease;
    }

    .app-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 10px 20px;
    }

    .app-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background-color: var(--header-bg);
      padding: 10px 20px;
      border-bottom: 1px solid var(--border-color);
      margin-bottom: 20px;
    }

    .app-title {
      margin: 0;
      font-size: 1.5rem;
    }

    .tab-container {
      display: flex;
      border-bottom: 1px solid var(--border-color);
      margin-bottom: 20px;
    }

    .tab {
      padding: 8px 16px;
      cursor: pointer;
      border: 1px solid var(--border-color);
      border-bottom: none;
      border-radius: 5px 5px 0 0;
      margin-right: 4px;
      background-color: var(--control-bg);
      color: var(--control-text);
    }

    .tab.active {
      background-color: var(--primary-color);
      color: white;
      border-color: var(--primary-color);
    }

    .controls {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      flex-wrap: wrap;
      gap: 10px;
    }

    .control-group {
      display: flex;
      gap: 10px;
      align-items: center;
      flex-wrap: wrap;
    }

    select, button {
      padding: 8px 12px;
      background-color: var(--control-bg);
      color: var(--control-text);
      border: 1px solid var(--border-color);
      border-radius: 4px;
      cursor: pointer;
    }

    button {
      background-color: var(--primary-color);
      color: white;
      border: none;
    }

    button:hover {
      opacity: 0.9;
    }

    .content-section {
      display: none;
    }

    .content-section.active {
      display: block;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 40px;
    }

    th, td {
      border: 1px solid var(--border-color);
      padding: 10px;
      text-align: center;
    }

    th {
      background-color: var(--table-header-bg);
      color: var(--table-header-text);
      position: sticky;
      top: 0;
    }

    .status-green { color: green; font-weight: bold; }
    .status-orange { color: orange; font-weight: bold; }
    .status-red { color: red; font-weight: bold; }

    .delayed-row { 
      background-color: var(--delayed-row-bg); 
      border-left: 4px solid red;
    }
    .completed-row { background-color: var(--completed-row-bg); }
    
    /* Add highlight animation for delayed flights */
    @keyframes highlight-pulse {
      0% { box-shadow: 0 0 0 0 rgba(255, 204, 0, 0.4); }
      70% { box-shadow: 0 0 0 10px rgba(255, 204, 0, 0); }
      100% { box-shadow: 0 0 0 0 rgba(255, 204, 0, 0); }
    }
    
    .delayed-row {
      animation: highlight-pulse 2s infinite;
    }

    .flight-logo {
      height: 20px;
      vertical-align: middle;
      margin-right: 5px;
    }

    .loading-indicator {
      text-align: center;
      padding: 20px;
      font-style: italic;
    }

    .weather-container {
      display: flex;
      justify-content: space-between;
      margin-bottom: 20px;
      flex-wrap: wrap;
      gap: 20px;
    }

    .weather-info {
      flex: 1;
      min-width: 300px;
      background-color: var(--secondary-color);
      border-radius: 8px;
      padding: 15px;
    }

    .weather-title {
      margin-top: 0;
      margin-bottom: 10px;
      font-size: 1.2rem;
      border-bottom: 1px solid var(--border-color);
      padding-bottom: 8px;
    }

    .weather-data {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
      gap: 10px;
    }

    .weather-item {
      display: flex;
      flex-direction: column;
    }

    .weather-label {
      font-size: 0.8rem;
      opacity: 0.7;
    }

    .weather-value {
      font-size: 1.1rem;
      font-weight: bold;
    }

    .runways-container {
      flex: 1;
      min-width: 300px;
      background-color: var(--secondary-color);
      border-radius: 8px;
      padding: 15px;
    }

    .runways-title {
      margin-top: 0;
      margin-bottom: 10px;
      font-size: 1.2rem;
      border-bottom: 1px solid var(--border-color);
      padding-bottom: 8px;
    }

    .runway-item {
      margin-bottom: 10px;
      padding: 8px;
      border-radius: 4px;
      background-color: var(--bg-color);
    }

    .install-button {
      position: fixed;
      bottom: 20px;
      right: 20px;
      z-index: 1000;
      background-color: var(--primary-color);
      color: white;
      padding: 10px 15px;
      border-radius: 50px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.2);
      display: none;
    }

    .last-updated {
      text-align: right;
      font-size: 0.8rem;
      margin-bottom: 10px;
      opacity: 0.7;
    }

    @media (max-width: 768px) {
      .controls {
        flex-direction: column;
        align-items: stretch;
      }
      
      .control-group {
        justify-content: space-between;
      }
      
      th, td {
        padding: 6px;
        font-size: 0.9rem;
      }
      
      .flight-logo {
        height: 16px;
      }
    }
  </style>
</head>
<body>
  <div class="app-container">
    <div class="app-header">
      <h1 class="app-title">AIX SEC OPS - Cochin Airport</h1>
      <button id="themeToggle">Toggle Dark Mode</button>
    </div>

    <div class="tab-container">
      <div class="tab active" data-tab="flights">Flights</div>
      <div class="tab" data-tab="weather">Weather & Runways</div>
    </div>

    <!-- Flights Section -->
    <div id="flights-section" class="content-section active">
      <div class="controls">
        <div class="control-group">
          <label>
            Airline Filter:
            <select id="airlineFilter">
              <option value="IX">AIX Only</option>
              <option value="IXAI">AIX + AI</option>
              <option value="IXOAL" selected>AIX + OAL</option>
            </select>
          </label>
          <label>
            Sort by:
            <select id="sortOption">
              <option value="scheduled" selected>STA / STD</option>
              <option value="estimated">ETA / ETD</option>
              <option value="delayed">Delayed First</option>
            </select>
          </label>
          <label>
            Time Window:
            <select id="timeWindow">
              <option value="6">6 Hours</option>
              <option value="12">12 Hours</option>
              <option value="20" selected>20 Hours</option>
              <option value="48">48 Hours</option>
            </select>
          </label>
        </div>
        <div class="control-group">
          <label>
            Flight Type:
            <select id="flightTypeFilter">
              <option value="all" selected>All</option>
              <option value="arrivals">Arrivals Only</option>
              <option value="departures">Departures Only</option>
            </select>
          </label>
          <button id="refreshButton">Refresh Data</button>
        </div>
      </div>

      <div class="last-updated" id="lastUpdated">Last updated: -</div>

      <div id="arrivals-container">
        <h2>Arrivals - AIX Security-COK</h2>
        <table id="arrivals-table">
          <thead>
            <tr>
              <th>Flight No</th>
              <th>Registration</th>
              <th>From</th>
              <th>ETA</th>
              <th>STA</th>
              <th>Aircraft</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td colspan="7" class="loading-indicator">Loading arrival data...</td>
            </tr>
          </tbody>
        </table>
      </div>

      <div id="departures-container">
        <h2>Departures - AIX Security-COK</h2>
        <table id="departures-table">
          <thead>
            <tr>
              <th>Flight No</th>
              <th>Registration</th>
              <th>To</th>
              <th>ETD</th>
              <th>STD</th>
              <th>Aircraft</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td colspan="7" class="loading-indicator">Loading departure data...</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Weather Section -->
    <div id="weather-section" class="content-section">
      <div class="weather-container">
        <div class="weather-info">
          <h3 class="weather-title">Current Weather at COK</h3>
          <div class="weather-data" id="weather-data">
            <div class="weather-item">
              <span class="weather-label">Loading weather data...</span>
              <span class="weather-value"></span>
            </div>
          </div>
        </div>

        <div class="runways-container">
          <h3 class="runways-title">Runway Information</h3>
          <div id="runways-data">
            <div class="runway-item">Loading runway data...</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <button id="installButton" class="install-button">Install App</button>

  <script>
    // API Configuration
    const API_BASE = "https://api.flightradar24.com/common/v1/airport.json";
    const AIRPORT_CODE = "cok";
    
    // Construct API URLs
    const getFlightEndpoint = (mode, timestamp) => {
      return `${API_BASE}?code=${AIRPORT_CODE}&plugin-setting[schedule][mode]=${mode}&plugin-setting[schedule][timestamp]=${timestamp}&page=1&limit=100`;
    };
    
    const getAirportInfoEndpoint = () => {
      return `${API_BASE}?code=${AIRPORT_CODE}&plugin[]=details&plugin[]=runways&plugin[]=weather&plugin-setting[satelliteImage][scale]=1`;
    };

    // Utility Functions
    const toLocalTime = (ts) => 
      ts ? new Date(ts * 1000).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit', hour12: false }) : "-";
    
    const toLocalDateTime = (ts) => 
      ts ? new Date(ts * 1000).toLocaleString([], { 
        month: 'short', 
        day: 'numeric', 
        hour: '2-digit', 
        minute: '2-digit', 
        hour12: false 
      }) : "-";
    
    const classifyStatus = (estimated, scheduled) => {
      if (!estimated || !scheduled) return "status-green";
      const delay = estimated - scheduled;
      if (delay <= 0) return "status-green";
      if (delay <= 900) return "status-orange"; // 15 minutes
      return "status-red";
    };

    const getLogoURL = (flightNumber) => {
      if (flightNumber.startsWith("IX")) {
        return "https://cdn.brandfetch.io/idM6IAvrlf/w/820/h/248/theme/dark/logo.png?c=1dxbfHSJFAPEGdCLU4o5B";
      } else if (flightNumber.startsWith("AI")) {
        return "https://cdn.brandfetch.io/id-PSmaCm4/w/800/h/284/theme/light/logo.png?c=1dxbfHSJFAPEGdCLU4o5B";
      } else if (flightNumber.startsWith("UL")) {
        return "https://cdn.brandfetch.io/idZQkqhbVi/w/800/h/578/theme/dark/symbol.png?c=1dxbfHSJFAPEGdCLU4o5B";
      } else if (flightNumber.startsWith("AK") || flightNumber.startsWith("FD")) {
        return "https://upload.wikimedia.org/wikipedia/commons/thumb/8/82/AirAsia_New_Logo_%282020%29.svg/768px-AirAsia_New_Logo_%282020%29.svg.png";
      } else if (flightNumber.startsWith("FZ")) {
        return "https://cdn.brandfetch.io/idzRsGDSFE/w/800/h/162/theme/dark/logo.png?c=1dxbfHSJFAPEGdCLU4o5B";
      } else if (flightNumber.startsWith("J9")) {
        return "https://cdn.brandfetch.io/idRWbgTyu0/w/800/h/248/theme/dark/logo.png?c=1dxbfHSJFAPEGdCLU4o5B";
      }
      return "";
    };

    // Flight Data Processing Functions
    const filterAndSortFlights = (flights, type) => {
      const filterValue = document.getElementById("airlineFilter").value;
      const sortOption = document.getElementById("sortOption").value;
      const timeWindowHours = parseInt(document.getElementById("timeWindow").value);
      const now = Math.floor(Date.now() / 1000);
      const oneHourInSeconds = 3600;

      return flights.filter(f => {
        const fn = f.flight?.identification?.number?.default || "";
        const airlineCode = fn.substring(0, 2);
        const est = type === "departures" ? f.flight.time.estimated?.departure : f.flight.time.estimated?.arrival;
        const sch = type === "departures" ? f.flight.time.scheduled?.departure : f.flight.time.scheduled?.arrival;
        const act = type === "departures" ? f.flight.time.actual?.departure : f.flight.time.actual?.arrival;

        // Include flights in the next X hours based on user selection
        const flightTime = sch || est || now;
        const futureTimeWindow = now + (timeWindowHours * 60 * 60);
        
        // Filter by airline
        let airlineMatch = false;
        if (filterValue === "IX") {
          airlineMatch = fn.startsWith("IX");
        } else if (filterValue === "IXAI") {
          airlineMatch = fn.startsWith("IX") || fn.startsWith("AI");
        } else {
          // AIX + OAL option with only specific airlines: UL, IX, FD, FZ, J9, AK
          airlineMatch = fn.startsWith("IX") || ["AK", "FD", "UL", "FZ", "J9"].includes(airlineCode);
        }
        
        // Check if flight is delayed (scheduled time is in the past but no actual time yet)
        const isDelayed = sch && now > sch && !act && (!est || est > now);
        
        // Include flights that match criteria
        if (airlineMatch) {
          // Always show delayed flights until they depart/arrive
          if (isDelayed) {
            return true;
          }
          
          // Flight hasn't departed/arrived yet and is within time window
          if (!act && (est > now || sch > now) && flightTime <= futureTimeWindow) {
            return true;
          }
          
          // Flight completed within the last hour (keep for 1 hour after arrival/departure)
          if (act && act > now - oneHourInSeconds) {
            return true;
          }
        }
        
        return false;
      }).sort((a, b) => {
        const now = Math.floor(Date.now() / 1000);
        
        // Helper to get the time values for sorting
        const getTimeValues = (f) => {
          const isDep = type === "departures";
          const est = isDep ? f.flight.time.estimated?.departure : f.flight.time.estimated?.arrival;
          const sch = isDep ? f.flight.time.scheduled?.departure : f.flight.time.scheduled?.arrival;
          const act = isDep ? f.flight.time.actual?.departure : f.flight.time.actual?.arrival;
          
          // A flight is delayed if its scheduled time is in the past, 
          // it hasn't actually departed/arrived yet, and either has no estimated time 
          // or the estimated time is in the future
          const isDelayed = sch && now > sch && !act && (!est || est > now);
          
          const isComplete = act && act <= now;
          
          return { est, sch, act, isDelayed, isComplete };
        };
        
        const aTime = getTimeValues(a);
        const bTime = getTimeValues(b);
        
        // Always prioritize delayed flights at the top regardless of sort option
        if (aTime.isDelayed && !bTime.isDelayed) return -1;
        if (!aTime.isDelayed && bTime.isDelayed) return 1;
        
        // Then sort by the selected criteria
        if (sortOption === "delayed") {
          // For non-delayed flights, prioritize incomplete flights
          if (!aTime.isComplete && bTime.isComplete) return -1;
          if (aTime.isComplete && !bTime.isComplete) return 1;
          
          // Then by estimated time
          return (aTime.est || aTime.sch || 0) - (bTime.est || bTime.sch || 0);
        } 
        else if (sortOption === "estimated") {
          return (aTime.est || aTime.sch || 0) - (bTime.est || bTime.sch || 0);
        } 
        else {
          return (aTime.sch || aTime.est || 0) - (bTime.sch || bTime.est || 0);
        }
      });
    };

    // Data Loading Functions
    const loadFlights = async (type) => {
      try {
        const timestamp = Math.floor(Date.now() / 1000);
        const res = await fetch(getFlightEndpoint(type, timestamp));
        const data = await res.json();
        
        if (data.result?.response?.airport?.pluginData?.schedule?.[type]?.data) {
          const flights = data.result.response.airport.pluginData.schedule[type].data;
          const tbody = document.querySelector(`#${type}-table tbody`);
          tbody.innerHTML = "";

          const filteredFlights = filterAndSortFlights(flights, type);
          const now = Math.floor(Date.now() / 1000);
          
          if (filteredFlights.length === 0) {
            tbody.innerHTML = `<tr><td colspan="7">No ${type} found matching the current criteria.</td></tr>`;
            return;
          }
          
          filteredFlights.forEach(f => {
            const fl = f.flight;
            const isDep = type === "departures";
            const est = isDep ? fl.time.estimated?.departure : fl.time.estimated?.arrival;
            const sch = isDep ? fl.time.scheduled?.departure : fl.time.scheduled?.arrival;
            const act = isDep ? fl.time.actual?.departure : fl.time.actual?.arrival;
            const fn = fl.identification.number?.default || "-";
            const logo = getLogoURL(fn);
            const reg = fl.aircraft?.registration || "-";
            const airportCode = isDep ? fl.airport.destination?.code?.iata : fl.airport.origin?.code?.iata || "-";
            const model = fl.aircraft?.model?.text || "-";
            const status = fl.status?.text || "-";
            
            // Determine if flight is delayed or completed
            const isDelayed = sch && now > sch && !act && (!est || est > now);
            const isCompleted = act && act <= now;
            
            const row = document.createElement("tr");
            if (isDelayed) {
              row.classList.add("delayed-row");
            } else if (isCompleted) {
              row.classList.add("completed-row");
            }
            
            row.innerHTML = `
              <td><img class="flight-logo" src="${logo}" alt="logo"> ${fn}</td>
              <td>${reg}</td>
              <td>${airportCode}</td>
              <td>${toLocalTime(est)}</td>
              <td>${toLocalTime(sch)}</td>
              <td>${model}</td>
              <td class="${classifyStatus(est, sch)}">${status}</td>
            `;
            tbody.appendChild(row);
          });
          
          // Update last refreshed time
          document.getElementById("lastUpdated").textContent = `Last updated: ${new Date().toLocaleTimeString()}`;
        } else {
          throw new Error(`No valid ${type} data found in API response`);
        }
      } catch (err) {
        console.error(`Error loading ${type}:`, err);
        const tbody = document.querySelector(`#${type}-table tbody`);
        tbody.innerHTML = `<tr><td colspan="7">Error loading ${type} data. Please try refreshing.</td></tr>`;
      }
    };

    const loadAirportInfo = async () => {
      try {
        const res = await fetch(getAirportInfoEndpoint());
        const data = await res.json();
        
        // Process Weather Data
        if (data.result?.response?.airport?.pluginData?.weather) {
          const weather = data.result.response.airport.pluginData.weather;
          const weatherContainer = document.getElementById("weather-data");
          weatherContainer.innerHTML = "";
          
          // Weather items to display
          const weatherItems = [
            { label: "Temperature", value: `${weather.temp?.celsius || "-"}°C` },
            { label: "Condition", value: weather.condition?.text || "-" },
            { label: "Wind", value: `${weather.wind?.speed?.kmh || "-"} km/h ${weather.wind?.direction?.text || ""}` },
            { label: "Visibility", value: `${weather.visibility?.km || "-"} km` },
            { label: "Humidity", value: `${weather.humidity || "-"}%` },
            { label: "Pressure", value: `${weather.pressure?.hpa || "-"} hPa` },
            { label: "Cloud Cover", value: `${weather.clouds?.coverage || "-"}%` },
            { label: "Updated", value: toLocalTime(weather.time?.timestamp) },
          ];
          
          weatherItems.forEach(item => {
            const div = document.createElement("div");
            div.className = "weather-item";
            div.innerHTML = `
              <span class="weather-label">${item.label}</span>
              <span class="weather-value">${item.value}</span>
            `;
            weatherContainer.appendChild(div);
          });
        }
        
        // Process Runway Data
        if (data.result?.response?.airport?.pluginData?.runways?.active) {
          const runways = data.result.response.airport.pluginData.runways.active;
          const runwaysContainer = document.getElementById("runways-data");
          runwaysContainer.innerHTML = "";
          
          if (runways.length === 0) {
            runwaysContainer.innerHTML = "<div class='runway-item'>No active runway data available</div>";
          } else {
            runways.forEach(runway => {
              const div = document.createElement("div");
              div.className = "runway-item";
              div.innerHTML = `
                <strong>Runway ${runway.name}</strong><br>
                Length: ${runway.length?.m || "-"} m / ${runway.length?.ft || "-"} ft<br>
                Surface: ${runway.surface || "-"}<br>
                ${runway.active === true ? '<span class="status-green">Currently Active</span>' : ''}
              `;
              runwaysContainer.appendChild(div);
            });
          }
        }
      } catch (err) {
        console.error("Error loading airport info:", err);
        document.getElementById("weather-data").innerHTML = "<div class='weather-item'>Error loading weather data. Please try refreshing.</div>";
        document.getElementById("runways-data").innerHTML = "<div class='runway-item'>Error loading runway data. Please try refreshing.</div>";
      }
    };

    const refreshAllFlights = () => {
      const flightTypeFilter = document.getElementById("flightTypeFilter").value;
      
      if (flightTypeFilter === "all" || flightTypeFilter === "arrivals") {
        document.getElementById("arrivals-container").style.display = "block";
        loadFlights("arrivals");
      } else {
        document.getElementById("arrivals-container").style.display = "none";
      }
      
      if (flightTypeFilter === "all" || flightTypeFilter === "departures") {
        document.getElementById("departures-container").style.display = "block";
        loadFlights("departures");
      } else {
        document.getElementById("departures-container").style.display = "none";
      }
    };

    // Theme Management
    const themeToggle = document.getElementById("themeToggle");
    const setTheme = (theme) => {
      document.documentElement.setAttribute("data-theme", theme);
      themeToggle.textContent = theme === "dark" ? "Toggle Light Mode" : "Toggle Dark Mode";
      localStorage.setItem("theme", theme);
    };

    const initializeTheme = () => {
      const savedTheme = localStorage.getItem("theme") || "light";
      setTheme(savedTheme);
    };

    // Tab Management
    const tabs = document.querySelectorAll('.tab');
    const contentSections = document.querySelectorAll('.content-section');

    tabs.forEach(tab => {
      tab.addEventListener('click', () => {
        // Deactivate all tabs and content sections
        tabs.forEach(t => t.classList.remove('active'));
        contentSections.forEach(cs => cs.classList.remove('active'));
        
        // Activate the clicked tab and its corresponding content
        tab.classList.add('active');
        const tabName = tab.getAttribute('data-tab');
        document.getElementById(`${tabName}-section`).classList.add('active');
        
        // Load data for the weather tab if it's selected
        if (tabName === 'weather') {
          loadAirportInfo();
        }
      });
    });

    // Event Listeners
    themeToggle.addEventListener("click", () => {
      const currentTheme = document.documentElement.getAttribute("data-theme") || "light";
      setTheme(currentTheme === "dark" ? "light" : "dark");
    });

    document.getElementById("airlineFilter").addEventListener("change", refreshAllFlights);
    document.getElementById("sortOption").addEventListener("change", refreshAllFlights);
    document.getElementById("timeWindow").addEventListener("change", refreshAllFlights);
    document.getElementById("flightTypeFilter").addEventListener("change", refreshAllFlights);
    document.getElementById("refreshButton").addEventListener("click", () => {
      refreshAllFlights();
      if (document.querySelector('.tab.active').getAttribute('data-tab') === 'weather') {
        loadAirportInfo();
      }
    });

    // PWA Installation Support
    let deferredPrompt;
    const installButton = document.getElementById('installButton');

    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      installButton.style.display = 'block';
    });

    installButton.addEventListener('click', () => {
      installButton.style.display = 'none';
      deferredPrompt.prompt();
      deferredPrompt.userChoice.then(choice => {
        if (choice.outcome === 'accepted') {
          console.log("App installed");
        }
        deferredPrompt = null;
      });
    });

    // Initialize App
    initializeTheme();
    refreshAllFlights();
    
    // Auto-refresh every 30 seconds
    setInterval(refreshAllFlights, 30000);
  </script>

  <script>
    // Service Worker Registration for PWA support
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./service
