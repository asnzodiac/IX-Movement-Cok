<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin – Bay/Belt Editor</title>
  <style>
    body { font-family: sans-serif; margin: 20px; }
    table { border-collapse: collapse; width: 100%; }
    th, td { border: 1px solid #ccc; padding: 6px; text-align: center; }
    th { background: #333; color: white; }
    input[type="text"] { width: 80px; }
    #backBtn { float: right; background: #555; color: white; border: none; padding: 6px 10px; border-radius: 4px; }
  </style>
</head>
<body>
  <h2>
    Admin Panel – Bay & Belt
    <button id="backBtn" onclick="location.href='index.html'">Back</button>
  </h2>
  <table id="adminTable">
    <thead><tr>
      <th>Flight</th><th>From</th><th>ETA</th><th>Status</th><th>Bay</th><th>Belt</th><th>Save</th>
    </tr></thead>
    <tbody></tbody>
  </table>

  <script>
    const API_BASE = "https://kittu-0wb2.onrender.com";
    async function loadFlights() {
      const res = await fetch(`${API_BASE}/flights?mode=arrivals`);
      const data = await res.json();
      const tbody = document.querySelector("#adminTable tbody");
      tbody.innerHTML = "";
      data.forEach(f => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${f.flight}</td><td>${f.from}</td><td>${new Date(f.eta * 1000).toLocaleTimeString()}</td><td>${f.status}</td>
          <td><input type="text" value="${f.bay}" id="bay-${f.flight}"></td>
          <td><input type="text" value="${f.belt}" id="belt-${f.flight}"></td>
          <td><button onclick="save('${f.flight}')">Save</button></td>
        `;
        tbody.appendChild(row);
      });
    }

    function save(flight) {
      const bay = document.getElementById(`bay-${flight}`).value;
      const belt = document.getElementById(`belt-${flight}`).value;
      fetch(`${API_BASE}/update`, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "Authorization": "Basic " + btoa("Aswin:admin")
        },
        body: JSON.stringify({ flight, bay, belt })
      }).then(r => {
        if (r.ok) alert("Saved!");
        else alert("Failed!");
      });
    }

    loadFlights();
  </script>
</body>
</html>
